<div class="container-fluid py-4">
  <h2 class="mb-4 fw-bold text-dark">Dashboard Quản trị</h2>

  <!-- Loading -->
  @if (loading) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  } @else if (data) {
  <!-- STAT CARDS -->
  <div class="row g-4 mb-5">
    <!-- Doanh thu hôm nay -->
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted small mb-1">Doanh thu hôm nay</p>
              <h4 class="mb-0 fw-bold text-success">{{ data.stats.revenueToday | currency:'VND':'symbol':'1.0-0' }}</h4>
              <small class="text-muted">{{ data.stats.ordersToday }} đơn hàng</small>
            </div>
            <i class="fas fa-money-bill-wave fa-2x text-success opacity-75"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Doanh thu tuần -->
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted small mb-1">Doanh thu tuần này</p>
              <h4 class="mb-0 fw-bold text-primary">{{ data.stats.revenueWeek | currency:'VND':'symbol':'1.0-0' }}</h4>
              <small class="text-muted">{{ data.stats.ordersWeek }} đơn hàng</small>
            </div>
            <i class="fas fa-calendar-week fa-2x text-primary opacity-75"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Doanh thu tháng -->
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted small mb-1">Doanh thu tháng này</p>
              <h4 class="mb-0 fw-bold text-info">{{ data.stats.revenueMonth | currency:'VND':'symbol':'1.0-0' }}</h4>
              <small class="text-muted">{{ data.stats.ordersMonth }} đơn hàng</small>
            </div>
            <i class="fas fa-calendar-alt fa-2x text-info opacity-75"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Khách mới -->
    <div class="col-md-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted small mb-1">Khách hàng mới tháng này</p>
              <h4 class="mb-0 fw-bold text-warning">{{ data.newCustomersThisMonth }}</h4>
              <small class="text-muted">người đăng ký</small>
            </div>
            <i class="fas fa-user-plus fa-2x text-warning opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BẢNG DOANH THU 10 NGÀY GẦN NHẤT -->
  <div class="card border-0 shadow-sm mb-5">
    <div class="card-header bg-white">
      <h5 class="mb-0">Doanh thu 10 ngày gần nhất</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Ngày</th>
              <th class="text-end">Doanh thu</th>
              <th class="text-end">So với hôm trước</th>
            </tr>
          </thead>
          <tbody>
            @for (day of data.last10DaysRevenue; track day.date) {
            <tr>
              <td>{{ day.date | date:'dd/MM/yyyy' }}</td>
              <td class="text-end fw-bold">{{ day.revenue | currency:'VND':'symbol':'1.0-0' }}</td>
              <td class="text-end">
                @if (day.changePercent > 0) {
                <span class="text-success">
                  <i class="fas fa-arrow-up"></i> +{{ day.changePercent | number:'1.1-1' }}%
                </span>
                } @else if (day.changePercent < 0) {
                <span class="text-danger">
                  <i class="fas fa-arrow-down"></i> {{ day.changePercent | number:'1.1-1' }}%
                </span>
                } @else {
                <span class="text-muted">—</span>
                }
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- TOP 5 SẢN PHẨM BÁN CHẠY -->
  <h5 class="mb-4">Top 5 sản phẩm bán chạy</h5>
  <div class="row g-4">
    <!-- Hôm nay -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white">
          <h6 class="mb-0">Hôm nay</h6>
        </div>
        <div class="card-body p-0">
          <ol class="list-group list-group-flush">
            @for (p of data.topProductsToday; track p.productId; let i = $index) {
            <li class="list-group-item d-flex align-items-center py-3">
              <span class="badge bg-primary rounded-pill me-3">{{ i + 1 }}</span>
              <img [src]="getImageUrl(p.thumbnail)" class="rounded me-3" width="50" height="50" [alt]="p.productName">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ p.productName }}</div>
                <small class="text-muted">{{ p.quantitySold }} đã bán • {{ p.revenue | currency:'VND':'symbol':'1.0-0' }}</small>
              </div>
            </li>
            }
          </ol>
        </div>
      </div>
    </div>

    <!-- Tuần này -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white">
          <h6 class="mb-0">Tuần này</h6>
        </div>
        <div class="card-body p-0">
          <ol class="list-group list-group-flush">
            @for (p of data.topProductsWeek; track p.productId; let i = $index) {
            <li class="list-group-item d-flex align-items-center py-3">
              <span class="badge bg-success rounded-pill me-3">{{ i + 1 }}</span>
              <img [src]="getImageUrl(p.thumbnail)" class="rounded me-3" width="50" height="50" [alt]="p.productName">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ p.productName }}</div>
                <small class="text-muted">{{ p.quantitySold }} đã bán • {{ p.revenue | currency:'VND':'symbol':'1.0-0' }}</small>
              </div>
            </li>
            }
          </ol>
        </div>
      </div>
    </div>

    <!-- Tháng này -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0">Tháng này</h6>
        </div>
        <div class="card-body p-0">
          <ol class="list-group list-group-flush">
            @for (p of data.topProductsMonth; track p.productId; let i = $index) {
            <li class="list-group-item d-flex align-items-center py-3">
              <span class="badge bg-info rounded-pill me-3">{{ i + 1 }}</span>
              <img [src]="getImageUrl(p.thumbnail)" class="rounded me-3" width="50" height="50" [alt]="p.productName">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ p.productName }}</div>
                <small class="text-muted">{{ p.quantitySold }} đã bán • {{ p.revenue | currency:'VND':'symbol':'1.0-0' }}</small>
              </div>
            </li>
            }
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- SẢN PHẨM SẮP HẾT HÀNG -->
  @if (data.lowStockProducts.length > 0) {
  <div class="card border-0 shadow-sm mt-5">
    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
    <h5 class="mb-0">
      <i class="fas fa-exclamation-triangle me-2"></i>
      Sản phẩm sắp hết hàng (dưới 10 cái) – {{ data.lowStockProducts.length }} sản phẩm
    </h5>
    <button class="btn btn-danger btn-sm" (click)="createImportOrderForLowStock()">
      <i class="fas fa-truck-loading me-1"></i>
      Lập phiếu nhập ngay
    </button>
  </div>
    <div class="card-body">
      <div class="row g-4">
        @for (p of data.lowStockProducts; track p.id) {
        <div class="col-md-4">
          <div class="d-flex align-items-center">
            <img [src]="getImageUrl(p.thumbnail)" class="rounded me-3" width="60" height="60" [alt]="p.name">
            <div>
              <div class="fw-medium">{{ p.name }}</div>
              <span class="badge bg-danger">Còn {{ p.stockQuantity }} sản phẩm</span>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
  }
  }
</div>